"use strict";(self["webpackChunkkams"]=self["webpackChunkkams"]||[]).push([[805],{7805:function(e,a,t){t.r(a),t.d(a,{default:function(){return c}});var i=function(){var e=this,a=e._self._c;return a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.isEmpty,expression:"isEmpty"},{name:"resize-ob",rawName:"v-resize-ob",value:e.cardResize,expression:"cardResize"}]},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"},{name:"resize-ob",rawName:"v-resize-ob",value:e.handleSizeChange,expression:"handleSizeChange"}],attrs:{fit:"",stripe:"",data:e.bots,height:e.tableHeight}},[a("el-table-column",{attrs:{prop:"name",label:"包名",align:"center",fixed:"left"}}),e.isChangeTable?[a("el-table-column",{attrs:{prop:"description",label:"描述",align:"center"}})]:e._e(),a("el-table-column",{attrs:{label:"版本",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v("v"+e._s(a.row.version))]}}])}),a("el-table-column",{attrs:{prop:"author",label:"作者",align:"center"}}),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("pps-button",{attrs:{theme:"text"},on:{click:function(a){return e.handleViewDetails(t.row)}}},[e._v("详情")]),a("pps-button",{attrs:{theme:"text"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")])]}}])})],2),a("pps-dialog",{attrs:{show:e.isShowDetailsDialog},on:{"update:show":function(a){e.isShowDetailsDialog=a}}},[a("template",{slot:"title"},[a("span",[e._v(e._s(e.viewDetailsData.name))]),Object.hasOwn(e.viewDetailsData,"dependencies")?a("el-select",{attrs:{placeholder:"版本列表","append-to-body":!1},model:{value:e.formInline,callback:function(a){e.formInline=a},expression:"formInline"}},e._l(e.obj2Arr(e.viewDetailsData.dependencies),(function(e,t){return a("el-option",{key:t,attrs:{label:e.value,value:e.value}})})),1):e._e()],1),a("template",{slot:"content"},[a("el-descriptions",{attrs:{direction:"vertical",column:2,border:""}},[a("el-descriptions-item",{attrs:{label:"许可证",labelClassName:"my-label",contentClassName:"my-label"}},[e._v(" "+e._s(e.viewDetailsData.license)+" ")]),a("el-descriptions-item",{attrs:{label:"文件",labelClassName:"my-label",contentClassName:"my-label"}},[e._v(" "+e._s(e.joinArr(e.viewDetailsData.files))+" ")]),a("el-descriptions-item",{attrs:{label:"语言",labelClassName:"my-label",contentClassName:"my-label"}},[e._v(" "+e._s(e.joinArr(e.viewDetailsData.kotori.meta.language))+" ")]),a("el-descriptions-item",{attrs:{label:"标签",labelClassName:"my-label",contentClassName:"my-label"}},e._l(e.viewDetailsData.keywords,(function(t,i){return a("el-tag",{key:i,attrs:{size:"small",type:e.tagsType[i],effect:"dark"}},[e._v(" "+e._s(t)+" ")])})),1),a("el-descriptions-item",{attrs:{span:2,label:"描述",labelClassName:"my-label",contentClassName:"my-label"}},[e._v(" "+e._s(e.viewDetailsData.description)+" ")]),a("el-descriptions-item",{attrs:{labelStyle:{display:"none"},span:2}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.viewDetailsData.pluginDependencies}},[a("el-table-column",{attrs:{align:"center",prop:"key",label:"依赖"}}),a("el-table-column",{attrs:{align:"center",prop:"value",label:"版本"}})],1)],1)],1)],1)],2),a("pps-dialog",{attrs:{show:e.isShowEditDialog,title:e.editDialogData.id},on:{confirmed:e.updateConfigFn,canceled:function(e){},"update:show":function(a){e.isShowEditDialog=a}}},[a("template",{slot:"content"},[a("vue-form",{attrs:{"ui-schema":e.uiSchema,schema:e.editDialogData.schema},model:{value:e.editDialogData.origin,callback:function(a){e.$set(e.editDialogData,"origin",a)},expression:"editDialogData.origin"}},[a("template",{slot:"default"},[a("span")])],2)],1)],2)],1)},s=[],l=t(2197),n={name:"modulesPage",data(){return{bots:[],isEmpty:!0,isChangeTable:!1,isShowDetailsDialog:!1,isShowEditDialog:!1,isLoading:!1,tableHeight:0,pluginDetail:{},formInline:"",viewDetailsData:{name:"",version:"",description:"",hasConfig:!0,main:"lib/index.js",keywords:[],license:"",files:[],author:"",dependencies:{},peerDependencies:{"kotori-bot":""},kotori:{meta:{language:[]}},pluginDependencies:[{dependencies:"",version:""},{dependencies:"",version:""}]},editDialogData:{id:"",origin:{},schema:{}},uiSchema:{bio:{"ui:options":{placeholder:"请输入你的签名",type:"textarea",rows:1}}},tagsType:["","success","info","danger","warning"]}},directives:{},methods:{handleViewDetails(e){this.isLoading=!0,this.viewDetailsData={...this.wiewDetailsData,...e},e.peerDependencies&&(this.viewDetailsData.pluginDependencies=this.obj2Arr(e.peerDependencies)),this.isShowDetailsDialog=!0,this.isLoading=!1},handleEdit(e){this.isLoading=!0,(0,l.HD)(e.name).then((({data:a})=>{if(this.isLoading=!1,!a.origin)return this.$message({message:"此插件没有配置文件！",type:"warning"});this.editDialogData.origin=a.origin,this.editDialogData.schema=a.schema,this.editDialogData.id=e.name,this.isShowEditDialog=!0}))},updateConfigFn(){const e=this.editDialogData.origin;(0,l.sK)(this.editDialogData.id,e).then((e=>204===e.status?this.$message({message:"更新成功！",type:"success"}):this.$message({message:"更新失败！",type:"error"}))).then((()=>{this.editDialogData.origin={},this.editDialogData.schema={}}))},handleSizeChange(e,a){this.isChangeTable=!(e<450)},cardResize(e,a){this.tableHeight=Math.floor(a)-40},obj2Arr(e){return Object.keys(e).map((a=>({key:a,value:e[a]})))},joinArr(e){return e.join("、")}},computed:{},async mounted(){const{data:e}=await(0,l.xr)();this.bots=e,this.isEmpty=!1}},o=n,r=t(8529),d=(0,r.A)(o,i,s,!1,null,"5a571edf",null),c=d.exports}}]);
//# sourceMappingURL=805.635a82e6.js.map